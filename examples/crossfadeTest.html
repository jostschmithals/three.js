<!DOCTYPE html>
<html lang="en">
	<head>
		<title></title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				color: #fff;
				font-family:Monospace;
				font-size:13px;
				background-color: #fff;
				margin: 0px;
				overflow: hidden;
			}
			#info {
				position: absolute;
				top: 0px;
				padding: 20px;
			}

		</style>
	</head>
	<body>
		<div id="container"></div>
		<div id="info">
			<button id="button1">1. Crossfade "run" to "idle"</button>
			<button id="button2">2. Play "run" again</button>
			<p id="data"></p>
		</div>

		<script src="../build/three.js"></script>

		<script>

			var container = document.getElementById( 'container' );
			var button1 = document.getElementById('button1');
			var button2 = document.getElementById('button2');
			var data = document.getElementById('data');

			var mesh, camera, scene, renderer, mixer;

			var clock = new THREE.Clock();

			var idleAction, runAction;


			scene = new THREE.Scene();
			scene.add ( new THREE.AmbientLight( 0xffffff ) );

			renderer = new THREE.WebGLRenderer( { antialias: true } );
			renderer.setClearColor( 0x333333 );
			renderer.setPixelRatio( window.devicePixelRatio );
			renderer.setSize( window.innerWidth, window.innerHeight );
			container.appendChild( renderer.domElement );


			new THREE.ObjectLoader().load( 'models/skinned/marine/marine_anims_core.json', function( loadedObject ) {

				loadedObject.traverse( function( child ) {

					if ( child instanceof THREE.SkinnedMesh ) {

						mesh = child;

					}

				} );

				mesh.rotation.y = -135 * Math.PI / 180;
				scene.add( mesh );

				var aspect = window.innerWidth / window.innerHeight;
				camera = new THREE.PerspectiveCamera( 45, aspect, 1, 1000 );
				camera.position.set( 0, 104, 364 );


// Animations ==================================================================


				mixer = new THREE.AnimationMixer ( mesh );

				idleAction = mixer.clipAction( 'idle' );
				runAction = mixer.clipAction( 'run' );

				idleAction.setEffectiveWeight( 0 ).play();
				runAction.setEffectiveWeight( 1 ).play();


				button1.onclick = function() {

					idleAction.setEffectiveWeight( 1 );
					runAction.crossFadeTo(idleAction, 5, true);

				}


				button2.onclick = function() {

//					runAction.setEffectiveTimeScale( 1 );          // <-- must be done manually!

					idleAction.setEffectiveWeight( 0 );
					runAction.enabled = true;

				}


// =============================================================================


				window.addEventListener( 'resize', onWindowResize, false );
				animate();


			});


			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}


			function animate() {

				requestAnimationFrame( animate );

				mixer.update( clock.getDelta() );
				
				data.innerHTML = 'runAction.getEffectiveTimeScale(): ' + runAction.getEffectiveTimeScale() + '<br>' +
								 'runAction.getEffectiveWeight(): ' + runAction.getEffectiveWeight() + '<br>' +
								 'runAction.enabled: ' + runAction.enabled + '<br><br>' +
					
								 'idleAction.getEffectiveTimeScale(): ' + idleAction.getEffectiveTimeScale() + '<br>' +
								 'idleAction.getEffectiveWeight(): ' + idleAction.getEffectiveWeight() + '<br>' +
								 'idleAction.enabled: ' + idleAction.enabled;
				
				renderer.render( scene, camera );

			}

		</script>

	</body>
</html>

